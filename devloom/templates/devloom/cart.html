{% extends 'devloom/base.html' %}
{% load static %}

{% block title %}ðŸ›’ Your Cart - DevLoom{% endblock %}

{% block content %}
<style>
    /* Use system font for a more native look */
    body, .cart-modern-font { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; }
    .cart-shadow { box-shadow: 0 8px 32px #e0e7ef44; }
    .cart-gradient-bg { background: linear-gradient(120deg, #e0f7fa 60%, #f7e9fc 100%); }
    .cart-btn-gradient { background: linear-gradient(90deg,#00e5ff,#0077ff); color: #fff; transition: transform 0.1s, box-shadow 0.1s; }
    .cart-btn-gradient:hover, .cart-btn-gradient:focus { transform: scale(1.03); box-shadow: 0 4px 16px #00e5ff55; }
    .cart-btn-outline { border: 2px solid #00e5ff; color: #00e5ff; background: #fff; transition: background 0.1s, color 0.1s; }
    .cart-btn-outline:hover, .cart-btn-outline:focus { background: #00e5ff; color: #fff; }
    .cart-btn-wa { background: #25D366; color: #fff; transition: transform 0.1s, box-shadow 0.1s; }
    .cart-btn-wa:hover, .cart-btn-wa:focus { transform: scale(1.03); box-shadow: 0 4px 16px #25D36655; }
    .cart-btn-dominant { background: linear-gradient(90deg,#0077ff,#00e5ff); color: #fff; font-weight: 700; font-size: 1.15rem; border-radius: 999px; width: 100%; box-shadow: 0 2px 12px #00e5ff44; transition: transform 0.1s, box-shadow 0.1s; }
    .cart-btn-dominant:hover, .cart-btn-dominant:focus { transform: scale(1.04); box-shadow: 0 6px 24px #00e5ff55; }
    .cart-totals-anim { font-variant-numeric: tabular-nums; }
    .cart-cross-sell { background: #f8fafc; border-radius: 18px; padding: 1.5rem; margin-top: 2.5rem; }
    .cart-cross-sell-title { font-weight: 600; color: #0077ff; margin-bottom: 1rem; }
    .cart-cross-sell-items { display: flex; gap: 1.2rem; flex-wrap: wrap; }
    .cart-cross-sell-item { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #e0e7ef33; padding: 0.8rem; width: 140px; text-align: center; transition: box-shadow 0.1s; }
    .cart-cross-sell-item:hover { box-shadow: 0 6px 24px #00e5ff33; }
    .cart-psych { margin-bottom: 1.5rem; }
    .cart-psych span { display: inline-block; margin-right: 1.2rem; font-size: 1.01rem; }
    @media (max-width: 600px) {
        .cart-cross-sell-items { flex-direction: column; align-items: center; }
        .cart-cross-sell-item { width: 100%; }
    }
</style>
<div class="d-flex justify-content-center align-items-center cart-gradient-bg" style="min-height: 80vh;">
    <div class="card shadow-lg border-0 p-4 w-100 animate__animated animate__fadeInUp cart-modern-font cart-shadow" style="max-width: 900px; border-radius: 28px; background: #fff; position: relative;">
        <div class="text-center mb-4">
            <h2 class="fw-bold mb-1" style="color: #0d1b2a; letter-spacing: 0.5px; font-size:2.1rem;">
                <span style="font-size:1.3rem; vertical-align:middle;">ðŸ›’</span> Your Cart
            </h2>
            <div class="cart-psych" style="font-size:0.98rem;">
                <span style="color:#eab308;">Order in <b>15 mins</b> for same-day dispatch.</span>
                <span style="color:#25D366; margin-left:1.2rem;">Secure checkout â€¢ Free returns</span>
                <span style="color:#0077ff; margin-left:1.2rem;">1,200+ bought this week</span>
            </div>
            <p class="text-muted mb-0" style="font-size: 1.05rem;">You have <strong>{{ count }}</strong> item{{ count|pluralize }} in your cart.<br><span style="color:#00e5ff;font-weight:600;">Ready to checkout?</span></p>
        </div>
        {% if items %}
            <div class="cart-items mb-4">
                {% for it in items %}
                <div class="d-flex align-items-center gap-3 p-3 mb-2 rounded" style="background: #f8fafc; border: 1px solid #e5e7eb;">
                    <div style="width: 80px; height: 60px; flex: 0 0 80px;">
                        {% if it.image %}
                            <img src="{% static it.image %}" alt="{{ it.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                        {% else %}
                            <img src="https://placehold.co/80x60?text=No+Image" alt="No Image" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; opacity:0.7;">
                        {% endif %}
                    </div>
                    <div class="flex-grow-1">
                        <div class="fw-semibold" style="font-size: 1.08rem; color: #222;">{{ it.name }}</div>
                        <div class="text-muted" style="font-size: 0.97rem;">
                            Qty: {{ it.qty }}
                            {% if it.size %} &middot; Size: {{ it.size }}{% endif %}
                            {% if it.color %} &middot; Color: <span style="display:inline-block;width:16px;height:16px;border-radius:50%;background:{{ it.color }};vertical-align:middle;"></span>{% endif %}
                            &middot; Ksh {{ it.price }}
                        </div>
                    </div>
                    <div class="text-end" style="min-width: 120px;">
                        <div class="fw-bold" style="color: #0ea5e9; font-size: 1.08rem;">Ksh {{ it.price|floatformat:2 }}</div>
                    </div>
                    <div style="flex: 0 0 80px; text-align: right;">
                        <form method="post" action="{% url 'remove_from_cart' it.id %}">{% csrf_token %}
                            <button type="submit" class="btn cart-btn-outline btn-sm" style="border-radius: 6px;">Remove</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="row align-items-start mt-4">
                <div class="col-md-6 mb-3 mb-md-0">
                    <a href="{% url 'product_list' %}" class="btn cart-btn-outline btn-lg px-4 py-2 w-100" style="border-radius: 999px; font-weight: 700; font-size: 1.08rem;">Continue shopping</a>
                    <a href="{{ wa_link }}" target="_blank" rel="noopener noreferrer" class="btn cart-btn-wa btn-lg w-100 mt-3" style="border-radius: 8px; font-weight: 600;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 4px;"><path d="M20.52 3.48A12.07 12.07 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.11.55 4.17 1.6 5.98L0 24l6.22-1.63A12.07 12.07 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.21-1.25-6.23-3.48-8.52zM12 22c-1.85 0-3.67-.5-5.24-1.44l-.37-.22-3.69.97.99-3.59-.24-.37A9.93 9.93 0 0 1 2 12c0-5.52 4.48-10 10-10s10 4.48 10 10-4.48 10-10 10zm5.2-7.8c-.28-.14-1.65-.81-1.9-.9-.25-.09-.43-.14-.61.14-.18.28-.7.9-.86 1.08-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.39-1.65-1.55-1.93-.16-.28-.02-.43.12-.57.12-.12.28-.32.42-.48.14-.16.18-.28.28-.46.09-.18.05-.34-.02-.48-.07-.14-.61-1.47-.84-2.01-.22-.53-.45-.46-.61-.47-.16-.01-.34-.01-.52-.01-.18 0-.48.07-.73.34-.25.27-.97.95-.97 2.3 0 1.35.99 2.65 1.13 2.83.14.18 1.95 2.98 4.74 4.06.66.28 1.18.45 1.58.58.66.21 1.26.18 1.73.11.53-.08 1.65-.67 1.88-1.32.23-.65.23-1.2.16-1.32-.07-.12-.25-.18-.53-.32z"/></svg>
                        WhatsApp Order
                    </a>
                    <a href="{% url 'place_order' %}" class="btn cart-btn-dominant btn-lg mt-3" style="display:block; text-align:center;">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" style="vertical-align:middle; margin-right:8px;"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="7" cy="21" r="1" fill="#fff"/><circle cx="17" cy="21" r="1" fill="#fff"/></svg>Place Order
                    </a>
                </div>
                <div class="col-md-6">
                    <div class="p-4 cart-shadow rounded" style="background: #f8fafc;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Subtotal</span>
                            <span class="fw-bold cart-totals-anim" id="subtotal">Ksh {{ subtotal|floatformat:2 }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Shipping</span>
                            <span class="fw-bold cart-totals-anim" id="shipping">Ksh {{ shipping|default:'0.00' }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Tax</span>
                            <span class="fw-bold cart-totals-anim" id="tax">Ksh {{ tax|default:'0.00' }}</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold" style="font-size:1.1rem;">Total</span>
                            <span class="fw-bold cart-totals-anim" id="total" style="font-size:1.2rem; color:#0077ff;">Ksh {{ total|default:subtotal|floatformat:2 }}</span>
                        </div>
                        {% if free_shipping_threshold and subtotal < free_shipping_threshold %}
                            <div class="mt-2 text-success" style="font-size:0.98rem;">Add Ksh {{ free_shipping_threshold|floatformat:2|add:'-'|add:subtotal|floatformat:2 }} more for <b>free shipping!</b></div>
                        {% elif free_shipping_threshold %}
                            <div class="mt-2 text-success" style="font-size:0.98rem;">ðŸŽ‰ You have unlocked <b>free shipping!</b></div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- Cross-sell section -->
            <div class="cart-cross-sell mt-5">
                <div class="cart-cross-sell-title">You might also like</div>
                <div class="cart-cross-sell-items">
                    {% for rec in recommendations %}
                    <div class="cart-cross-sell-item">
                        <img src="{% static rec.image %}" alt="{{ rec.name }}" style="width: 80px; height: 60px; object-fit: cover; border-radius: 8px; margin-bottom: 0.5rem;">
                        <div class="fw-semibold" style="font-size: 1.01rem;">{{ rec.name }}</div>
                        <div class="text-muted" style="font-size: 0.95rem;">Ksh {{ rec.price|floatformat:2 }}</div>
                        <a href="{% url 'product_detail' rec.id %}" class="btn btn-sm cart-btn-outline mt-2">View</a>
                    </div>
                    {% empty %}
                    <div class="text-muted">No recommendations right now.</div>
                    {% endfor %}
                </div>
            </div>
            <script>
                // Animate numbers (totals)
                function animateValue(id, start, end, duration) {
                    let range = end - start;
                    let current = start;
                    let increment = range / (duration/16);
                    let obj = document.getElementById(id);
                    let step = 0;
                    function update() {
                        step++;
                        current += increment;
                        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                            obj.textContent = 'Ksh ' + end.toFixed(2);
                        } else {
                            obj.textContent = 'Ksh ' + current.toFixed(2);
                            requestAnimationFrame(update);
                        }
                    }
                    update();
                }
                document.addEventListener('DOMContentLoaded', function() {
                    // Example: animateValue('subtotal', 0, parseFloat('{{ subtotal|floatformat:2 }}'), 800);
                    // You can add more animations for shipping, tax, total if desired.
                });
            </script>
        {% else %}
            <div class="text-center py-5 cart-gradient-bg" style="border-radius: 24px; box-shadow: 0 8px 32px #e0e7ef44; max-width: 540px; margin: 0 auto; position: relative;">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 12px;">
                    <ellipse cx="40" cy="70" rx="28" ry="6" fill="#e0e7ef"/>
                    <rect x="22" y="30" width="36" height="28" rx="8" fill="#fff" stroke="#00e5ff" stroke-width="2"/>
                    <rect x="32" y="38" width="16" height="8" rx="2" fill="#e0e7ef"/>
                    <circle cx="40" cy="44" r="2" fill="#00e5ff"/>
                    <rect x="36" y="50" width="8" height="4" rx="2" fill="#00e5ff"/>
                      <text x="40" y="60" text-anchor="middle" fill="#00bcd4" font-size="15" font-weight="bold" style="text-shadow:0 1px 4px #fff,0 0 2px #00e5ff;">Empty Cart</text>
                </svg>
                <h4 class="fw-bold mt-3 mb-2" style="color: #0d1b2a;">Your cart is lonely!</h4>
                <p class="text-muted mb-4">Add some products to make it happy. ðŸ˜Ž</p>
                <a href="{% url 'product_list' %}" class="btn cart-btn-gradient btn-lg px-4 py-2" style="border-radius: 999px; font-weight: 700; font-size: 1.15rem;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" style="vertical-align:middle; margin-right:8px;"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="7" cy="21" r="1" fill="#fff"/><circle cx="17" cy="21" r="1" fill="#fff"/></svg>
                    Shop Now
                </a>
                <div class="mt-4">
                    <div class="fw-bold mb-2" style="color:#0077ff;">Popular right now:</div>
                    <div class="d-flex justify-content-center gap-2 flex-wrap">
                        <a href="{% url 'product_list' %}?category=laptops" class="btn btn-sm" style="background:#e0f7fa; color:#0077ff; border-radius:999px; font-weight:600;">Laptops</a>
                        <a href="{% url 'product_list' %}?category=desktops" class="btn btn-sm" style="background:#f7e9fc; color:#a020f0; border-radius:999px; font-weight:600;">Desktops</a>
                        <a href="{% url 'product_list' %}?category=accessories" class="btn btn-sm" style="background:#fffbe7; color:#eab308; border-radius:999px; font-weight:600;">Accessories</a>
                    </div>
                </div>
                <script>
                function showConfetti() {
                    const confettiColors = ["#00e5ff", "#0077ff", "#eab308", "#a020f0", "#f7e9fc", "#e0f7fa"];
                    for(let i=0;i<40;i++){
                        let conf = document.createElement('div');
                        conf.style.position='fixed';
                        conf.style.left=Math.random()*100+'vw';
                        conf.style.top='-20px';
                        conf.style.width='10px';
                        conf.style.height='10px';
                        conf.style.borderRadius='50%';
                        conf.style.background=confettiColors[Math.floor(Math.random()*confettiColors.length)];
                        conf.style.zIndex=9999;
                        conf.style.opacity=0.8;
                        conf.style.transition='top 1.8s cubic-bezier(.4,2,.6,1)';
                        document.body.appendChild(conf);
                        setTimeout(()=>{conf.style.top='90vh';},100);
                        setTimeout(()=>{conf.remove();},2000);
                    }
                }
                try {
                    if(localStorage.getItem('showConfetti')==='1') {
                        showConfetti();
                        localStorage.removeItem('showConfetti');
                    }
                } catch(e) {}
                </script>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
