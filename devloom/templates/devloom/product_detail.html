
{% extends 'devloom/base.html' %}
{% load static %}
{% block extra_css %}
<style>
    .product-detail-section {
        background: linear-gradient(120deg, #f6f8fb 60%, #e9eef7 100%) !important;
        min-height: 90vh;
        position: relative;
        z-index: 1;
    }
    .product-main-img {
        border: 4px solid #00d9ff;
        box-shadow: 0 8px 32px #00d9ff22, 0 2px 16px #0001;
        transition: transform 0.3s cubic-bezier(.4,2,.6,1), box-shadow 0.3s;
    }
    .product-main-img:hover {
        transform: scale(1.04) rotate(-2deg);
        box-shadow: 0 16px 48px #00d9ff44, 0 2px 16px #0002;
    }
    .product-detail-section .card, .product-detail-section .bg-white {
        border-radius: 2rem !important;
        border: none !important;
        box-shadow: 0 8px 32px #001f3f18, 0 2px 16px #0001 !important;
    }
    .product-detail-section h1, .product-detail-section h5 {
        letter-spacing: 0.5px;
    }
    @media (max-width: 768px) {
        .product-detail-section .p-5 { padding: 1.5rem !important; }
        .product-detail-section .p-4 { padding: 1rem !important; }
    }
</style>
{% endblock %}

{% block title %}DevLoom | {{ product.name }}{% endblock %}

{% block content %}
<section class="product-detail-section py-5">
    <div class="container">
        <div class="row justify-content-center align-items-start g-4">
            <div class="col-lg-5 col-md-6 col-12">
                <div class="position-relative bg-white shadow-lg rounded-4 p-4 h-100 d-flex flex-column align-items-center animate__animated animate__fadeInLeft">
                    <div class="mb-3 w-100 d-flex gap-2">
                        <span class="badge bg-danger">OFFER</span>
                        <span class="badge bg-primary">HOT</span>
                    </div>
                    <div class="mb-3 w-100 text-center">
                        {% if product.image %}
                            <img id="mainProductImg" src="{% static product.image %}" alt="{{ product.name }}" class="img-fluid rounded-4 shadow-sm product-main-img" style="max-height: 380px; object-fit: contain; background: #f7fafc; cursor: zoom-in;">
                            <!-- Modal for fullscreen image -->
                            <div id="imgModal" class="modal" tabindex="-1" style="display:none; position:fixed; z-index:1050; left:0; top:0; width:100vw; height:100vh; overflow:auto; background:rgba(0,0,0,0.85); align-items:center; justify-content:center;">
                                <span id="closeModal" style="position:absolute;top:30px;right:40px;font-size:3rem;color:#fff;cursor:pointer;font-weight:700;z-index:1100;">&times;</span>
                                <img id="modalImg" src="{% static product.image %}" alt="{{ product.name }}" style="max-width:90vw; max-height:90vh; display:block; margin:auto; border-radius:1rem; box-shadow:0 8px 32px #00d9ff44, 0 2px 16px #0002; transition:transform 0.2s; cursor:zoom-out;" />
                            </div>
                        {% else %}
                            <div class="d-flex align-items-center justify-content-center rounded-4" style="width: 100%; height: 340px; background: #e0e7ef;">
                                <span class="text-muted">No Image</span>
                            </div>
                        {% endif %}
                    {% block extra_js %}
                    <script>
                    // Fullscreen modal logic
                    const mainImg = document.getElementById('mainProductImg');
                    const modal = document.getElementById('imgModal');
                    const modalImg = document.getElementById('modalImg');
                    const closeModal = document.getElementById('closeModal');
                    if (mainImg && modal && modalImg && closeModal) {
                        mainImg.addEventListener('click', function() {
                            modal.style.display = 'flex';
                            document.body.style.overflow = 'hidden';
                        });
                        closeModal.addEventListener('click', function() {
                            modal.style.display = 'none';
                            document.body.style.overflow = '';
                            modalImg.style.transform = 'scale(1)';
                        });
                        modal.addEventListener('click', function(e) {
                            if (e.target === modal) {
                                modal.style.display = 'none';
                                document.body.style.overflow = '';
                                modalImg.style.transform = 'scale(1)';
                            }
                        });
                        // Zoom on wheel
                        let scale = 1;
                        modalImg.addEventListener('wheel', function(e) {
                            e.preventDefault();
                            if (e.deltaY < 0) {
                                scale = Math.min(scale + 0.1, 3);
                            } else {
                                scale = Math.max(scale - 0.1, 1);
                            }
                            modalImg.style.transform = `scale(${scale})`;
                        });
                        // Double click to reset zoom
                        modalImg.addEventListener('dblclick', function() {
                            scale = 1;
                            modalImg.style.transform = 'scale(1)';
                        });
                    }
                    </script>
                    <style>
                    .modal { display: none; align-items: center; justify-content: center; }
                    .modal[style*="display: flex"] { display: flex !important; }
                    </style>
                    {% endblock %}
                    </div>
                    <div class="d-flex gap-2 justify-content-center w-100">
                        {% if product.image %}
                            <img src="{% static product.image %}" alt="{{ product.name }} thumbnail" class="rounded-3 border border-2" style="width: 60px; height: 60px; object-fit: cover; border-color: #e5e7eb;">
                        {% endif %}
                        <!-- Add more thumbnails here if available -->
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-md-6 col-12">
                <div class="bg-white shadow-lg rounded-4 p-5 h-100 animate__animated animate__fadeInRight">
                    {% if product.category %}
                        <div class="mb-2 text-muted" style="font-size: 1.1rem; letter-spacing: 0.5px;">{{ product.category.name }}</div>
                    {% endif %}
                    <h1 class="fw-bold mb-2" style="font-size: 2.3rem; color: #0d1b2a;">{{ product.name }}</h1>
                    <div class="d-flex align-items-center gap-3 mb-2">
                        <span class="fw-bold" style="font-size: 1.5rem; color: #22c55e;">Ksh {{ product.price }}</span>
                        <span class="badge bg-success">IN STOCK</span>
                    </div>
                    <div class="mb-2" style="color: #f59e42; font-size: 1.15rem;">
                        ★★★★★ <span class="text-muted" style="font-size: 1rem;">0 Reviews</span>
                    </div>
                    <div class="mb-4">
                        <h5 class="fw-semibold mb-2" style="color: #222;">Key Features of {{ product.name }}</h5>
                        <ul class="ps-3" style="color: #222;">
                            <li><b>Description:</b><br> <span style="font-weight: 400;">{{ cleaned_desc|linebreaksbr|default:'N/A' }}</span></li>
                            <li><b>RAM:</b> <span style="font-weight: 400;">{{ ram|default:'N/A' }}</span></li>
                            <li><b>Internal Storage:</b> <span style="font-weight: 400;">{{ storage|default:'N/A' }}</span></li>
                            <li><b>Price:</b> <span style="font-weight: 400;">Ksh {{ product.price|default:'N/A' }}</span></li>
                            <li><b>Stock:</b> <span style="font-weight: 400;">{{ product.stock|default:'N/A' }}</span></li>
                        </ul>
                    </div>
                    <form method="post" action="{% url 'add_to_cart' product.id %}" class="mb-3">{% csrf_token %}
                        <button type="submit" class="btn btn-primary btn-lg px-5 py-2 shadow-sm" style="border-radius: 10px; font-weight: 700; font-size: 1.15rem; letter-spacing: 0.5px;" onclick="try{localStorage.setItem('showConfetti','1');}catch(e){}">Add to Cart</button>
                    </form>
                    <div class="d-flex gap-2 mb-3">
                        <a href="https://wa.me/254111670942?text={{ 'I want to order '|urlencode }}{{ product.name|urlencode }}" target="_blank" rel="noopener noreferrer" class="btn btn-success px-4" style="border-radius: 10px; font-weight: 600;">WhatsApp</a>
                        <a href="tel:+254111670942" class="btn btn-outline-secondary px-4" style="border-radius: 10px; font-weight: 600;">Call</a>
                    </div>
                    <div class="mt-4">
                        <div class="alert alert-success rounded-3">
                            <b>Our Corporate customers</b> can place their orders at <a href="mailto:corporates@devloom.com" class="fw-bold">corporates@devloom.com</a>.<br>
                            <span>Call DevLoom Care for Smartphone Repairs at <b>0745 063030</b></span><br>
                            <span class="text-muted">NB: Warranty registration is the customer's responsibility</span>
                        </div>
                    </div>
                    <a href="{% url 'product_list' %}" class="btn btn-link mt-3">&larr; Back to Products</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}